# docker-network-capture

A small utility that can help you debug network problems of Docker containers.

## Prerequisites

Make sure you have `tcpdump` package installed, the execution requires root privileges

## Usage

```
$ docker-network-capture --help
usage: docker-network-capture [-h] [--verbose] [-b BRIDGE] [-c CAPTURE]
                              [-d DOCKER]
                              container

positional arguments:
  container

optional arguments:
  -h, --help            show this help message and exit
  --verbose
  -b BRIDGE, --bridge BRIDGE
                        Docker bridge to use
  -c CAPTURE, --capture CAPTURE
                        Direction of traffic to capture [egress,ingress]
  -d DOCKER, --docker DOCKER
```

## Example

In the following example we see the output of `docker-network-capture` for a container
in which `curl google.com` was executed:

```
$ sudo docker-network-capture --capture=egress,ingress --verbose 92707a5e8369
[+] Initializing packet capture on: "docker0" for container: "92707a5e8369"
Packet: 1
  00 01 02 03 04 05 06 07 08 09 10 11 12 13 14 15
+-------------------------------------------------+----------------+
| D9 58 FE 57 BA CA 06 00 46 00 00 00 46 00 00 00 |.X.W....F...F...|
| 02 42 D5 89 AD E2 02 42 AC 11 00 02 08 00 45 00 |.B.....B......E.|
| 00 38 C6 3C 40 00 40 11 B9 25 AC 11 00 02 0A 26 |.8.<@.@..%.....&|
| 05 1A BC E7 00 35 00 24 BB 88 4A 17 01 00 00 01 |.....5.$..J.....|
| 00 00 00 00 00 00 06 67 6F 6F 67 6C 65 03 63 6F |.......google.co|
| 6D 00 00 01 00 01 D9 58 FE 57 E9 CA 06 00 46 00 |m......X.W....F.|
| 00 00 46 00 00 00 02 42 D5 89 AD E2 02 42 AC 11 |..F....B.....B..|
| 00 02 08 00 45 00 00 38 C6 3D 40 00 40 11 B9 24 |....E..8.=@.@..$|
| AC 11 00 02 0A 26 05 1A BC E7 00 35 00 24 BB 88 |.....&.....5.$..|
| 56 35 01 00 00 01 00 00 00 00 00 00 06 67 6F 6F |V5...........goo|
| 67 6C 65 03 63 6F 6D 00 00 1C 00 01             |gle.com.....    |
+-------------------------------------------------+----------------+
Packet: 2
  00 01 02 03 04 05 06 07 08 09 10 11 12 13 14 15
+-------------------------------------------------+----------------+
| D9 58 FE 57 5C 94 07 00 56 00 00 00 56 00 00 00 |.X.W\...V...V...|
| 02 42 AC 11 00 02 02 42 D5 89 AD E2 08 00 45 00 |.B.....B......E.|
| 00 48 48 2C 00 00 36 11 81 26 0A 26 05 1A AC 11 |.HH,..6..&.&....|
| 00 02 00 35 BC E7 00 34 46 AB 4A 17 81 80 00 01 |...5...4F.J.....|
| 00 01 00 00 00 00 06 67 6F 6F 67 6C 65 03 63 6F |.......google.co|
| 6D 00 00 01 00 01 C0 0C 00 01 00 01 00 00 00 7D |m..............}|
| 00 04 D8 3A C9 4E D9 58 FE 57 86 94 07 00 62 00 |...:.N.X.W....b.|
| 00 00 62 00 00 00 02 42 AC 11 00 02 02 42 D5 89 |..b....B.....B..|
| AD E2 08 00 45 00 00 54 48 2D 00 00 36 11 81 19 |....E..TH-..6...|
| 0A 26 05 1A AC 11 00 02 00 35 BC E7 00 40 35 5B |.&.......5...@5[|
| 56 35 81 80 00 01 00 01 00 00 00 00 06 67 6F 6F |V5...........goo|
| 67 6C 65 03 63 6F 6D 00 00 1C 00 01 C0 0C 00 1C |gle.com.........|
| 00 01 00 00 00 6C 00 10 2A 00 14 50 40 14 08 00 |.....l..*..P@...|
| 00 00 00 00 00 00 20 0E                         |...... .        |
+-------------------------------------------------+----------------+
Packet: 3
  00 01 02 03 04 05 06 07 08 09 10 11 12 13 14 15
+-------------------------------------------------+----------------+
| D9 58 FE 57 5B B6 07 00 4A 00 00 00 4A 00 00 00 |.X.W[...J...J...|
| 02 42 D5 89 AD E2 02 42 AC 11 00 02 08 00 45 00 |.B.....B......E.|
| 00 3C 25 D6 40 00 40 06 C7 49 AC 11 00 02 D8 3A |.<%.@.@..I.....:|
| C9 4E D1 B8 00 50 79 3C 9E 2A 00 00 00 00 A0 02 |.N...Py<.*......|
| 72 10 4D CB 00 00 02 04 05 B4 04 02 08 0A 01 6F |r.M............o|
| BB FC 00 00 00 00 01 03 03 07                   |..........      |
+-------------------------------------------------+----------------+
Packet: 4
  00 01 02 03 04 05 06 07 08 09 10 11 12 13 14 15
+-------------------------------------------------+----------------+
| D9 58 FE 57 B6 19 08 00 4A 00 00 00 4A 00 00 00 |.X.W....J...J...|
| 02 42 AC 11 00 02 02 42 D5 89 AD E2 08 00 45 00 |.B.....B......E.|
| 00 3C 55 3F 00 00 32 06 E5 E0 D8 3A C9 4E AC 11 |.<U?..2....:.N..|
| 00 02 00 50 D1 B8 D0 9B 16 05 79 3C 9E 2B A0 12 |...P......y<.+..|
| A6 2C 1C 9F 00 00 02 04 05 96 04 02 08 0A 27 75 |.,............'u|
| 82 B3 01 6F BB FC 01 03 03 07                   |...o......      |
+-------------------------------------------------+----------------+
Packet: 5
  00 01 02 03 04 05 06 07 08 09 10 11 12 13 14 15
+-------------------------------------------------+----------------+
| D9 58 FE 57 E4 19 08 00 42 00 00 00 42 00 00 00 |.X.W....B...B...|
| 02 42 D5 89 AD E2 02 42 AC 11 00 02 08 00 45 00 |.B.....B......E.|
| 00 34 25 D7 40 00 40 06 C7 50 AC 11 00 02 D8 3A |.4%.@.@..P.....:|
| C9 4E D1 B8 00 50 79 3C 9E 2B D0 9B 16 06 80 10 |.N...Py<.+......|
| 00 E5 4D C3 00 00 01 01 08 0A 01 6F BC 16 27 75 |..M........o..'u|
| 82 B3 D9 58 FE 57 1A 1A 08 00 8C 00 00 00 8C 00 |...X.W..........|
| 00 00 02 42 D5 89 AD E2 02 42 AC 11 00 02 08 00 |...B.....B......|
| 45 00 00 7E 25 D8 40 00 40 06 C7 05 AC 11 00 02 |E..~%.@.@.......|
| D8 3A C9 4E D1 B8 00 50 79 3C 9E 2B D0 9B 16 06 |.:.N...Py<.+....|
| 80 18 00 E5 4E 0D 00 00 01 01 08 0A 01 6F BC 16 |....N........o..|
| 27 75 82 B3 47 45 54 20 2F 20 48 54 54 50 2F 31 |'u..GET / HTTP/1|
| 2E 31 0D 0A 48 6F 73 74 3A 20 67 6F 6F 67 6C 65 |.1..Host: google|
| 2E 63 6F 6D 0D 0A 55 73 65 72 2D 41 67 65 6E 74 |.com..User-Agent|
| 3A 20 63 75 72 6C 2F 37 2E 34 37 2E 31 0D 0A 41 |: curl/7.47.1..A|
| 63 63 65 70 74 3A 20 2A 2F 2A 0D 0A 0D 0A       |ccept: */*....  |
+-------------------------------------------------+----------------+
Packet: 6
  00 01 02 03 04 05 06 07 08 09 10 11 12 13 14 15
+-------------------------------------------------+----------------+
| D9 58 FE 57 F7 7E 08 00 42 00 00 00 42 00 00 00 |.X.W.~..B...B...|
| 02 42 AC 11 00 02 02 42 D5 89 AD E2 08 00 45 00 |.B.....B......E.|
| 00 34 55 53 00 00 32 06 E5 D4 D8 3A C9 4E AC 11 |.4US..2....:.N..|
| 00 02 00 50 D1 B8 D0 9B 16 06 79 3C 9E 75 80 10 |...P......y<.u..|
| 01 4D EF AE 00 00 01 01 08 0A 27 75 82 CD 01 6F |.M........'u...o|
| BC 16                                           |..              |
+-------------------------------------------------+----------------+
Packet: 7
  00 01 02 03 04 05 06 07 08 09 10 11 12 13 14 15
+-------------------------------------------------+----------------+
| D9 58 FE 57 B4 82 08 00 19 02 00 00 19 02 00 00 |.X.W............|
| 02 42 AC 11 00 02 02 42 D5 89 AD E2 08 00 45 00 |.B.....B......E.|
| 02 0B 55 54 00 00 32 06 E3 FC D8 3A C9 4E AC 11 |..UT..2....:.N..|
| 00 02 00 50 D1 B8 D0 9B 16 06 79 3C 9E 75 80 18 |...P......y<.u..|
| 01 4D 2D 1C 00 00 01 01 08 0A 27 75 82 CE 01 6F |.M-.......'u...o|
| BC 16 48 54 54 50 2F 31 2E 31 20 33 30 32 20 46 |..HTTP/1.1 302 F|
| 6F 75 6E 64 0D 0A 43 61 63 68 65 2D 43 6F 6E 74 |ound..Cache-Cont|
| 72 6F 6C 3A 20 70 72 69 76 61 74 65 0D 0A 43 6F |rol: private..Co|
| 6E 74 65 6E 74 2D 54 79 70 65 3A 20 74 65 78 74 |ntent-Type: text|
| 2F 68 74 6D 6C 3B 20 63 68 61 72 73 65 74 3D 55 |/html; charset=U|
| 54 46 2D 38 0D 0A 4C 6F 63 61 74 69 6F 6E 3A 20 |TF-8..Location: |
| 68 74 74 70 3A 2F 2F 77 77 77 2E 67 6F 6F 67 6C |http://www.googl|
| 65 2E 63 7A 2F 3F 67 66 65 5F 72 64 3D 63 72 26 |e.cz/?gfe_rd=cr&|
| 65 69 3D 32 56 6A 2D 56 39 66 77 49 65 48 66 38 |ei=2Vj-V9fwIeHf8|
| 67 65 55 2D 4C 43 34 44 67 0D 0A 43 6F 6E 74 65 |geU-LC4Dg..Conte|
| 6E 74 2D 4C 65 6E 67 74 68 3A 20 32 35 38 0D 0A |nt-Length: 258..|
| 44 61 74 65 3A 20 57 65 64 2C 20 31 32 20 4F 63 |Date: Wed, 12 Oc|
| 74 20 32 30 31 36 20 31 35 3A 33 38 3A 30 31 20 |t 2016 15:38:01 |
| 47 4D 54 0D 0A 0D 0A 3C 48 54 4D 4C 3E 3C 48 45 |GMT....<HTML><HE|
| 41 44 3E 3C 6D 65 74 61 20 68 74 74 70 2D 65 71 |AD><meta http-eq|
| 75 69 76 3D 22 63 6F 6E 74 65 6E 74 2D 74 79 70 |uiv="content-typ|
| 65 22 20 63 6F 6E 74 65 6E 74 3D 22 74 65 78 74 |e" content="text|
| 2F 68 74 6D 6C 3B 63 68 61 72 73 65 74 3D 75 74 |/html;charset=ut|
| 66 2D 38 22 3E 0A 3C 54 49 54 4C 45 3E 33 30 32 |f-8">.<TITLE>302|
| 20 4D 6F 76 65 64 3C 2F 54 49 54 4C 45 3E 3C 2F | Moved</TITLE></|
| 48 45 41 44 3E 3C 42 4F 44 59 3E 0A 3C 48 31 3E |HEAD><BODY>.<H1>|
| 33 30 32 20 4D 6F 76 65 64 3C 2F 48 31 3E 0A 54 |302 Moved</H1>.T|
| 68 65 20 64 6F 63 75 6D 65 6E 74 20 68 61 73 20 |he document has |
| 6D 6F 76 65 64 0A 3C 41 20 48 52 45 46 3D 22 68 |moved.<A HREF="h|
| 74 74 70 3A 2F 2F 77 77 77 2E 67 6F 6F 67 6C 65 |ttp://www.google|
| 2E 63 7A 2F 3F 67 66 65 5F 72 64 3D 63 72 26 61 |.cz/?gfe_rd=cr&a|
| 6D 70 3B 65 69 3D 32 56 6A 2D 56 39 66 77 49 65 |mp;ei=2Vj-V9fwIe|
| 48 66 38 67 65 55 2D 4C 43 34 44 67 22 3E 68 65 |Hf8geU-LC4Dg">he|
| 72 65 3C 2F 41 3E 2E 0D 0A 3C 2F 42 4F 44 59 3E |re</A>...</BODY>|
| 3C 2F 48 54 4D 4C 3E 0D 0A D9 58 FE 57 DE 82 08 |</HTML>...X.W...|
| 00 42 00 00 00 42 00 00 00 02 42 D5 89 AD E2 02 |.B...B....B.....|
| 42 AC 11 00 02 08 00 45 00 00 34 25 D9 40 00 40 |B......E..4%.@.@|
| 06 C7 4E AC 11 00 02 D8 3A C9 4E D1 B8 00 50 79 |..N.....:.N...Py|
| 3C 9E 75 D0 9B 17 DD 80 10 00 ED 4D C3 00 00 01 |<.u........M....|
| 01 08 0A 01 6F BC 31 27 75 82 CE                |....o.1'u..     |
+-------------------------------------------------+----------------+
Packet: 8
  00 01 02 03 04 05 06 07 08 09 10 11 12 13 14 15
+-------------------------------------------------+----------------+
| D9 58 FE 57 29 83 08 00 42 00 00 00 42 00 00 00 |.X.W)...B...B...|
| 02 42 D5 89 AD E2 02 42 AC 11 00 02 08 00 45 00 |.B.....B......E.|
| 00 34 25 DA 40 00 40 06 C7 4D AC 11 00 02 D8 3A |.4%.@.@..M.....:|
| C9 4E D1 B8 00 50 79 3C 9E 75 D0 9B 17 DD 80 11 |.N...Py<.u......|
| 00 ED 4D C3 00 00 01 01 08 0A 01 6F BC 31 27 75 |..M........o.1'u|
| 82 CE                                           |..              |
+-------------------------------------------------+----------------+
Packet: 9
  00 01 02 03 04 05 06 07 08 09 10 11 12 13 14 15
+-------------------------------------------------+----------------+
| D9 58 FE 57 F9 E4 08 00 42 00 00 00 42 00 00 00 |.X.W....B...B...|
| 02 42 AC 11 00 02 02 42 D5 89 AD E2 08 00 45 00 |.B.....B......E.|
| 00 34 55 66 00 00 32 06 E5 C1 D8 3A C9 4E AC 11 |.4Uf..2....:.N..|
| 00 02 00 50 D1 B8 D0 9B 17 DD 79 3C 9E 76 80 11 |...P......y<.v..|
| 01 4D ED A0 00 00 01 01 08 0A 27 75 82 E7 01 6F |.M........'u...o|
| BC 31                                           |.1              |
+-------------------------------------------------+----------------+
Packet: 10
  00 01 02 03 04 05 06 07 08 09 10 11 12 13 14 15
+-------------------------------------------------+----------------+
| D9 58 FE 57 1F E5 08 00 42 00 00 00 42 00 00 00 |.X.W....B...B...|
| 02 42 D5 89 AD E2 02 42 AC 11 00 02 08 00 45 00 |.B.....B......E.|
| 00 34 25 DB 40 00 40 06 C7 4C AC 11 00 02 D8 3A |.4%.@.@..L.....:|
| C9 4E D1 B8 00 50 79 3C 9E 76 D0 9B 17 DE 80 10 |.N...Py<.v......|
| 00 ED 4D C3 00 00 01 01 08 0A 01 6F BC 4A 27 75 |..M........o.J'u|
| 82 E7                                           |..              |
+-------------------------------------------------+----------------+
Exiting
```

## License

GNU/GPL 2.0
